<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Case Game</title>
</head>
<body>

  <h1>Case Game</h1>
  <p id="balance">Загрузка...</p>
  <button onclick="spin()">Крутить дешёвый кейс</button>

  <script>
    const tg = window.Telegram.WebApp
    tg.expand()

    async function auth() {
      const response = await fetch("/auth", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          initData: tg.initData
        })
      })

      const data = await response.json()
      document.getElementById("balance").innerText =
        "Баланс: " + data.balance
    }

    async function spin() {
      const user = tg.initDataUnsafe.user

      const response = await fetch("/spin", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          telegram_id: user.id,
          case_type: "cheap"
        })
      })

      const data = await response.json()
      alert("Выигрыш: " + data.win)
      auth()
    }

    auth()
  </script>

</body>
</html>